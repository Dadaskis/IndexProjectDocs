<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>
			Index Project - common_editor
		</title>
		<link rel="preload" as="image" href="../../../assets/images/_docs_background.png">
		<link rel="stylesheet" type="text/css" href="../../../assets/style.css">
	</head>
	<body>
		<div class="scanlines">
		</div>
		<script src="../../../assets/sidebar_injector_module.js">
		</script>
		<center>
			<div class="everything">
				<div class="sidebar">
					<h1>
						Index Project Guide
					</h1>
					<br/>
					<br/>
					<input type="text" class="searchbar" placeholder="Search...">
						<div class="sidebar-content" id="sidebar-content">
						</div>
					</div>
					<div class="main_body">
						<h3>
							Module: common_editor
						</h3>
						<p class="red-marking">
							Documentation last edited: October 22, 2025 at 10:46 UTC
						</p>
						<div class="lang-select-div">
							<a href="./index.html">
								ENG
							</a>
							<a href="./index_rus.html">
								RUS
							</a>
						</div>
						<h4>
							Description
						</h4>
						<p>
							<img src="../../../assets/images/common_editor/example0.jpg" width="400px" onclick="maximizeImage(this)" class="clickable-image">
								<br>
								<br>
								A module for common editor development tools. For the time being it has:<br>
								- Gizmos that are used by both <code>
									comics_renderer
								</code>
								and <code>
									character_builder
								</code>
								modules<br>
								- Properties UI usable for material editing or other potential purposes<br>
								<br>
								<code>
									Adding gizmos support to your editor
								</code>
								<br>
								- Instance the following scenes in your editor scene:<code class="gdscript">
									<br>
									"res://modules/common_editor/assets/prefabs/position.tscn"<br>
									"res://modules/common_editor/assets/prefabs/rotation.tscn"
								</code>
								<br>
								Then, in your main editor script (i assume it's assigned to the root node):<br>
								<code>
									Steal and forget
								</code>
								<br>
								<code class="gdscript">
									<br>
									# Rotation gizmo node that appears when you can rotate something<br>
									onready var rotation_gizmo = $rotation<br>
									# Position gizmo node that shows up when you can reposition something<br>
									onready var position_gizmo = $position<br>
									<br>
									# Array of all selected hitbodies<br>
									var selected =
									[]
									<br>
									# This variable is used for more precise check of currently selected body.<br>
									# It might not actually store a current one, so you'd better use selected
									[0]
									<br>
									var selected_body = null<br>
									# Is user selecting something right now? Used for selection fix<br>
									var is_selecting = false<br>
									# Amount of frames in which user haven't selected anything yet<br>
									# Used for selection fix<br>
									var nothing_selected_frames = 0<br>
									<br>
									# Force selection of certain object. phys_body must have a hit_body script<br>
									# referred to it<br>
									func force_selection(phys_body):<br>
									&emsp;select_node_process(phys_body, true)<br>
									<br>
									# Returns a ray dictionary of raycast check. It is sending a ray under cursor.<br>
									func get_camera_ray():<br>
									&emsp;var camera = MainCamera.get_camera()<br>
									&emsp;if not is_instance_valid(camera):<br>
									&emsp;&emsp;return null<br>
									&emsp;var mouse_pos = get_viewport().get_mouse_position()<br>
									&emsp;var from = camera.project_ray_origin(mouse_pos)<br>
									&emsp;var to = from + camera.project_ray_normal(mouse_pos) * 100.0<br>
									&emsp;var space_state = get_world().get_direct_space_state()<br>
									&emsp;var ray = space_state.intersect_ray(from, to)<br>
									&emsp;return ray<br>
									<br>
									# Additional selection check to fix selection inconsistency.<br>
									# Always checking if there's any object under cursor, and if there's one<br>
									# it is resetting nothing_selected_frames and is setting selected_body.<br>
									# Called every physics frame.<br>
									func check_node_selection_ray():<br>
									&emsp;var ray = get_camera_ray()<br>
									&emsp;if not ray:<br>
									&emsp;&emsp;nothing_selected_frames += 1<br>
									&emsp;&emsp;return<br>
									&emsp;if not ray.collider:<br>
									&emsp;&emsp;nothing_selected_frames += 1<br>
									&emsp;&emsp;return<br>
									&emsp;nothing_selected_frames = 0<br>
									&emsp;selected_body = ray.collider<br>
									<br>
									# I've stolen that shit from Comics Renderer and now i'm not even sure what<br>
									# the fuck it does here. Alright, it used to do some generic selection<br>
									# logic here, but it was replaced by that fucked up selection fix i've made.<br>
									# It is still used in one case when nothing_selected_frames counter is above 10.<br>
									# I don't know why, and i don't want to know why, and i'm not gonna change it.<br>
									func select_node(unselect_previous = true):<br>
									&emsp;var ray = get_camera_ray()<br>
									&emsp;if not ray:<br>
									&emsp;&emsp;selected.clear()<br>
									&emsp;&emsp;position_gizmo.reset_selection()<br>
									&emsp;&emsp;rotation_gizmo.reset_selection()<br>
									&emsp;&emsp;return<br>
									&emsp;if not ray.collider:<br>
									&emsp;&emsp;return<br>
									&emsp;select_node_process(ray.collider, unselect_previous)<br>
									<br>
									# Processes selection logic of the target body, used by selection fix instead of select_node.<br>
									# Checks for both HIT_BODY of  "CommonEditorBody" used by gizmos.<br>
									func select_node_process(body, unselect_previous = true):<br>
									&emsp;if not is_instance_valid(body):<br>
									&emsp;&emsp;return<br>
									&emsp;var hit_body = \<br>
									&emsp;&emsp;HitBodyTool.get_node_property(body, "CommonEditorBody")<br>
									&emsp;if hit_body:<br>
									&emsp;&emsp;select_hit_body(hit_body, unselect_previous)<br>
									<br>
									# Select a hit_body, simple as that<br>
									func select_hit_body(hit_body, unselect_previous = true):<br>
									&emsp;if hit_body.is_selected:<br>
									&emsp;&emsp;rotation_gizmo.remove_selected(hit_body)<br>
									&emsp;&emsp;position_gizmo.remove_selected(hit_body)<br>
									&emsp;&emsp;hit_body.unselect_node()<br>
									&emsp;&emsp;selected.erase(hit_body)<br>
									&emsp;&emsp;return<br>
									&emsp;if unselect_previous and not hit_body.dont_deselect_others:<br>
									&emsp;&emsp;for select_body in selected:<br>
									&emsp;&emsp;&emsp;select_body.unselect_node()<br>
									&emsp;&emsp;rotation_gizmo.reset_selection()<br>
									&emsp;&emsp;position_gizmo.reset_selection()<br>
									&emsp;&emsp;selected =
									[]
									<br>
									&emsp;if hit_body.can_be_rotated:<br>
									&emsp;&emsp;rotation_gizmo.add_selected(hit_body)<br>
									&emsp;if hit_body.can_be_positioned:<br>
									&emsp;&emsp;position_gizmo.add_selected(hit_body)<br>
									&emsp;hit_body.select_node()<br>
									&emsp;selected.append(hit_body)<br>
									<br>
									# Unselect a hit_body<br>
									func unselect_hit_body(hit_body):<br>
									&emsp;if hit_body.is_selected:<br>
									&emsp;&emsp;position_gizmo.remove_selected(hit_body)<br>
									&emsp;&emsp;rotation_gizmo.remove_selected(hit_body)<br>
									&emsp;&emsp;hit_body.unselect_node()<br>
									&emsp;&emsp;selected.erase(hit_body)<br>
									<br>
									# Input function, simply checks if user is selecting anything<br>
									func _input(event):<br>
									&emsp;if event is InputEventMouseButton:<br>
									&emsp;&emsp;if in_UI:<br>
									&emsp;&emsp;&emsp;return<br>
									&emsp;&emsp;if event.button_index == 1 and event.pressed:<br>
									&emsp;&emsp;&emsp;is_selecting = true<br>
									<br>
									# Physics frame update to check following things:<br>
									# - If nothing_selected_frames is greater than 10, there's no selected_body<br>
									# - If the user is selecting something, it'll run the selection logic<br>
									func _physics_process(delta):<br>
									&emsp;if nothing_selected_frames >
									10:<br>
									&emsp;&emsp;selected_body = null<br>
									&emsp;check_node_selection_ray()<br>
									&emsp;if is_selecting:<br>
									&emsp;&emsp;is_selecting = false<br>
									&emsp;&emsp;var keep = Input.is_key_pressed(KEY_SHIFT) or \<br>
									&emsp;&emsp;&emsp;Input.is_key_pressed(KEY_CONTROL)<br>
									&emsp;&emsp;if nothing_selected_frames >
									10:<br>
									&emsp;&emsp;&emsp;select_node(not keep)<br>
									&emsp;&emsp;else:<br>
									&emsp;&emsp;&emsp;select_node_process(selected_body, not keep)<br>
								</code>
								<br>
								All of this code should be enough to add support for gizmos in your main editor script, HOWEVER, you need to add this support to your fellow edited objects as well.<br>
								<br>
								<code>
									Common Editor HitBody support
								</code>
								<br>
								<code class="gdscript">
									<br>
									# Reference to the hit body script used for selection and interaction<br>
									const HIT_BODY = preload(<br>
									&emsp;"res://modules/common_editor/src/common_editor_hit_body.gd")<br>
									<br>
									hit_body = HIT_BODY.new()<br>
									hit_body.real_node = self<br>
									hit_body.can_be_rotated = true<br>
									hit_body.can_be_positioned = true<br>
									hit_body.can_be_removed = true<br>
									var size = get_aabb().get_longest_axis_size()<br>
									hit_body.rotation_scale = size * 0.8<br>
									hit_body.position_scale = size * 0.8<br>
									HitBodyTool.add_node_property(static_body, HIT_BODY.OBJECT_NAME, hit_body)<br>
								</code>
								<br>
								<br>
								AND this is not enough for your supported object to move around! If you want to make it move around, add this snippet:<br>
								<code class="gdscript">
									<br>
									# Handles rotation operations from input<br>
									# axis: Rotation axis vector<br>
									# value: Rotation amount<br>
									func on_rotate(axis: Vector3, value: float):<br>
									&emsp;var og_axis = axis<br>
									&emsp;var bone_rot = value * 0.005<br>
									&emsp;if slow_edit:<br>
									&emsp;&emsp;bone_rot *= 0.2<br>
									&emsp;rotate_object_local(axis, bone_rot)<br>
									&emsp;rot_data.vec3 = rotation_degrees<br>
									<br>
									# Handles position offset operations from input<br>
									# offset: Translation vector<br>
									func on_offset(offset: Vector3):<br>
									&emsp;if slow_edit:<br>
									&emsp;&emsp;offset *= 0.1<br>
									&emsp;global_transform.origin += offset<br>
									&emsp;pos_data.vec3 = position<br>
								</code>
								<br>
								Common Editor's HitBody is calling the following methods in <code class="gdscript">
									real_node
								</code>
								:<br>
								<code class="gdscript">
									<br>
									on_select &emsp;&emsp;# Called on selection<br>
									on_unselect &emsp;# Called when unselected<br>
									on_rotate&emsp;&emsp;&emsp;# Called when rotated<br>
									on_rotate&emsp;&emsp;&emsp;# Called on positional offset<br>
								</code>
								<br>
								<br>
								It could've been simpler, but we love shooting our legs, right? :)
							</p>
							<h3>
								General Information
							</h3>
							<h4>
								Root directories list
							</h4>
							<p>
								assets, docs, src
							</p>
							<h4>
								Nodes
							</h4>
							<p>
								<a class="a_simple" href="./scripts/vbox_fill_x.html">
									vbox_fill_x
								</a>
								<br>
								<a class="a_simple" href="./scripts/properties.html">
									properties
								</a>
								<br>
								<a class="a_simple" href="./scripts/editor_rotation_axis.html">
									editor_rotation_axis
								</a>
								<br>
								<a class="a_simple" href="./scripts/material_property.html">
									material_property
								</a>
								<br>
								<a class="a_simple" href="./scripts/editor_rotation.html">
									editor_rotation
								</a>
								<br>
								<a class="a_simple" href="./scripts/editor_position_axis.html">
									editor_position_axis
								</a>
								<br>
								<a class="a_simple" href="./scripts/editor_position.html">
									editor_position
								</a>
							</p>
							<h4>
								Classes
							</h4>
							<p>
								<a class="a_simple" href="./scripts/common_editor_hit_body.html">
									common_editor_hit_body
								</a>
								<br>
								<a class="a_simple" href="./scripts/properties_data.html">
									CE_PropertiesData
								</a>
							</p>
							<h4>
								Resources
							</h4>
							<p>
								None
							</p>
							<h4>
								Other Scripts
							</h4>
							<p>
								None
							</p>
						</div>
					</div>
				</center>
				<script src="../../../assets/code_blocks.js">
				</script>
			</body>
		</html>
